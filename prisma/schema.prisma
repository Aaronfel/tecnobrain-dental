// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

enum UserType {
    CLINIC
    PATIENT
    ADMIN
}

enum VisitStatus {
    PROGRAMADA
    CONFIRMADA
    EN_PROGRESO
    COMPLETADA
    CANCELADA
    NO_ASISTIO
}

enum VisitType {
    LIMPIEZA
    REVISION
    EMPASTE
    ENDODONCIA
    CORONA
    EXTRACCION
    CONSULTA
    EMERGENCIA
}

model User {
    id           Int      @id @default(autoincrement())
    name         String
    email        String   @unique
    passwordHash String
    userType     UserType
    createdAt    DateTime @default(now())
    updatedAt    DateTime @updatedAt

    // One-to-many relationship: Clinic -> Patients
    patients     User[]   @relation("ClinicPatients")
    clinicId     Int?
    clinic       User?    @relation("ClinicPatients", fields: [clinicId], references: [id])

    // Visits relationship
    visitsAsPatient Visit[] @relation("PatientVisits")
    visitsAsClinic  Visit[] @relation("ClinicVisits")
}

model Visit {
    id          Int         @id @default(autoincrement())
    title       String
    startTime   DateTime
    endTime     DateTime
    type        VisitType
    status      VisitStatus @default(PROGRAMADA)
    notes       String?
    patientId   Int
    clinicId    Int
    createdAt   DateTime    @default(now())
    updatedAt   DateTime    @updatedAt

    patient User @relation("PatientVisits", fields: [patientId], references: [id])
    clinic  User @relation("ClinicVisits", fields: [clinicId], references: [id])
}
